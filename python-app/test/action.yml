name: "test"
description: "run unittest"

inputs:
  src-path:
    description: "path to src directory"
    required: false
    default: "src"
  report-format:
    required: false

runs:
  using: "composite"
  steps:
    - name: Run unittest
      run: |
        pipenv run pytest -s --cov=./${SRC} --cov-report=${FORMAT}
      env:
        SRC: ${{ inputs.src-path }}
        FORMAT: ${{ inputs.report-format }}
      shell: bash

    - name: Optionally run mypy
      run: |
        if [[ "${{ inputs.ignore-mypy }}" == "true" ]]; then
          echo "Ignoring Mypy as specified in action inputs"
          exit 0
        fi
        if $(pipenv run python -c "import mypy" 2> /dev/null); then
          echo "run mypy on ${SRC}"
          pipenv run mypy --install-types --non-interactive ${SRC}
        else
          echo "mypy not installed, skipping";
        fi
      env:
        SRC: ${{ inputs.src-path }}
      shell: bash
