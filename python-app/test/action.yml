name: "test"
description: "run unittest"

inputs:
  src-path:
    description: "path to src directory"
    required: false
    default: "src"

runs:
  using: "composite"
  steps:
    - name: pipenv
      uses: LedgerHQ/actions/python-app/init@main

    - name: Run unittest
      run: |
        pipenv run pytest -s --cov=./${SRC}
      env:
        SRC: ${{ inputs.src-path }}
      shell: bash

    - name: Figure out where mypy is coming from
      run: |
        python -c "import mypy"
        pipenv run python -c "import mypy"
        pipenv run pip freeze

    - name: Optionally run mypy
      run: |
        if $(pipenv run python -c "import mypy" 2> /dev/null); then
          echo "run mypy on ${SRC}"
          pipenv run mypy --install-types --non-interactive ${SRC}
        else
          echo "mypy not installed, skipping";
        fi
      env:
        SRC: ${{ inputs.src-path }}
      shell: bash
